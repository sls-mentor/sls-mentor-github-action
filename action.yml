name: "Sls mentor "
description: "run sls-mentor"
inputs:
  level:
    description: "Sls-mentor level"
    required: false
    default: "1"
    type: string
  iam-role:
    description: "IAM role to assume"
    required: true
    type: string
  iam-role-session-name:
    description: "IAM role session name"
    required: false
    default: "sls-mentor"
    type: string
  aws-region:
    description: "AWS region"
    required: false
    default: "eu-west-1"
    type: string
  sls-mentor-version:
    description: "Sls-mentor version"
    required: false
    default: "latest"
    type: string
runs:
  using: "composite"
  steps:
    - name: configure aws credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        role-to-assume: ${{inputs.iam-role}}
        role-session-name: ${{inputs.iam-role-session-name}}
        aws-region: ${{inputs.aws-region}}
    - name: "sls-mentor-run"
      id: sls-mentor-run
      run: |
        echo "SLS_MENTOR_RESULT<<EOF"$'\n'"$(npx sls-mentor@${{inputs.sls-mentor-version}} --level ${{inputs.sls-mentor-level}} --noFail)"$'\n'EOF >> "$GITHUB_ENV"
      shell: bash
    - uses: actions/github-script@v6
      with:
        script: |
          const output = `Sls-mentor result: ${process.env.SLS_MENTOR_RESULT}`;
          await github.rest.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: context.payload.number,
            body: output
          });
